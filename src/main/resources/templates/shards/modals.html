<!— templates/fragments/modals.html —>
<!-- и модальные окна, и скрипты -->

<div th:fragment="modals(allRoles, csrf)">
    <!-- Edit Modal -->
    <div class="modal fade" id="editUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" th:action="@{/admin/update}">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="edit-id" class="form-label fw-bold text-center w-100">Id</label>
                            <input type="text" class="form-control bg-light" id="edit-id" name="id" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="edit-name" class="form-label fw-bold text-center w-100">First name</label>
                            <input type="text" class="form-control" id="edit-name" name="name" required>
                        </div>

                        <div class="mb-3">
                            <label for="edit-lastName" class="form-label fw-bold text-center w-100">Last name</label>
                            <input type="text" class="form-control" id="edit-lastName" name="lastName" required>
                        </div>

                        <div class="mb-3">
                            <label for="edit-age" class="form-label fw-bold text-center w-100">Age</label>
                            <input type="number" class="form-control" id="edit-age" name="age" required>
                        </div>

                        <div class="mb-3">
                            <label for="edit-email" class="form-label fw-bold text-center w-100">Email</label>
                            <input type="email" class="form-control" id="edit-email" name="email" required>
                        </div>

                        <div class="mb-3">
                            <label for="edit-password" class="form-label fw-bold text-center w-100">Password</label>
                            <input type="password" class="form-control" id="edit-password" name="password">
                            <small class="form-text text-muted">Leave blank if you don't want to change your
                                password</small>
                        </div>

                        <div class="mb-3">
                            <label for="edit-roles" class="form-label fw-bold text-center w-100">Roles</label>
                            <select multiple class="form-select" id="edit-roles" name="roleIds" size="2">
                                <option th:each="role : ${allRoles}"
                                        th:value="${role.id}"
                                        th:text="${role.name}"></option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- modal для удаления пользователя -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" th:action="@{/admin/delete}">
                    <div class="modal-header">
                        <h5 class="modal-title">Delete User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="delete-id" class="form-label fw-bold text-center w-100">Id</label>
                            <input type="text" class="form-control bg-light" id="delete-id" name="id" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="delete-name" class="form-label fw-bold text-center w-100">Name</label>
                            <input type="text" class="form-control bg-light" id="delete-name" name="name" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="delete-lastName" class="form-label fw-bold text-center w-100">Lastname</label>
                            <input type="text" class="form-control bg-light" id="delete-lastName" name="lastName" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="delete-age" class="form-label fw-bold text-center w-100">Age</label>
                            <input type="number" class="form-control bg-light" id="delete-age" name="age" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="delete-email" class="form-label fw-bold text-center w-100">Email</label>
                            <input type="email" class="form-control bg-light" id="delete-email" name="email" readonly>
                        </div>

                        <div class="mb-3">
                            <label for="delete-roles" class="form-label fw-bold text-center w-100">Roles</label>
                            <select multiple class="form-select bg-light" id="delete-roles" name="roleIds" size="2" disabled>
                                <option th:each="role : ${allRoles}"
                                        th:value="${role.id}"
                                        th:text="${role.name}"></option>
                            </select>
                        </div>

                        <!-- CSRF -->
                        <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger">Delete user</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- скрипты js -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const editModal = new bootstrap.Modal(document.getElementById('editUserModal'));
        const deleteModal = new bootstrap.Modal(document.getElementById('deleteUserModal'));

        function openEditModal(button) {
            const id = button.getAttribute("data-user-id");
            const name = button.getAttribute("data-name");
            const lastName = button.getAttribute("data-lastname");
            const email = button.getAttribute("data-email");
            const age = button.getAttribute("data-age");
            const roles = button.getAttribute("data-roles");
            const roleIds = roles ? roles.split(',') : [];

            document.getElementById("edit-id").value = id;
            document.getElementById("edit-name").value = name;
            document.getElementById("edit-lastName").value = lastName;
            document.getElementById("edit-email").value = email;
            document.getElementById("edit-age").value = age;
            document.getElementById("edit-password").value = '';

            const select = document.getElementById("edit-roles");
            for (let i = 0; i < select.options.length; i++) {
                select.options[i].selected = roleIds.includes(select.options[i].value);
            }
            editModal.show();
        }

        function openDeleteModal(button) {
            const id = button.getAttribute("data-user-id");
            const name = button.getAttribute("data-name");
            const lastName = button.getAttribute("data-lastname");
            const email = button.getAttribute("data-email");
            const age = button.getAttribute("data-age");
            const roles = button.getAttribute("data-roles");
            const roleIds = roles ? roles.split(',') : [];

            document.getElementById("delete-id").value = id;
            document.getElementById("delete-name").value = name;
            document.getElementById("delete-lastName").value = lastName;
            document.getElementById("delete-email").value = email;
            document.getElementById("delete-age").value = age;

            const select = document.getElementById("delete-roles");
            for (let i = 0; i < select.options.length; i++) {
                select.options[i].selected = roleIds.includes(select.options[i].value);
            }
            deleteModal.show();
        }
    </script>
</div>
